"""
Dateisystem-Fehler Diagnose und Reparatur
Das Log-Verzeichnis /usr/share/docassemble/log fehlt
"""

def analyze_filesystem_error():
    print("ğŸš¨ KRITISCHER DATEISYSTEM-FEHLER IDENTIFIZIERT")
    print("="*50)
    
    print("ğŸ“‹ PROBLEM ANALYSE:")
    print("-" * 20)
    print("   ğŸ¯ ERROR: Log-Verzeichnis /usr/share/docassemble/log fehlt")
    print("   ğŸ¯ Supervisor kann Celery nicht starten")
    print("   ğŸ¯ worker.log Pfad existiert nicht")
    print("   ğŸ¯ Container stuck in Restart-Loop")
    
    print("\nğŸ’¡ ROOT CAUSE:")
    print("-" * 15)
    print("   ğŸ” Volume-Mount Problem oder")
    print("   ğŸ” Verzeichnis-Struktur beschÃ¤digt durch")
    print("   ğŸ” Unsere intensive API-Tests")
    print("   ğŸ” MÃ¶glicherweise Berechtigungsprobleme")
    
    print("\nğŸ› ï¸ SOFORTIGE REPARATUR:")
    print("-" * 25)
    
    print("   OPTION 1: VERZEICHNIS IM CONTAINER ERSTELLEN")
    print("   # Container-ID ermitteln:")
    print('   CONTAINER_ID=$(docker ps -q --filter "ancestor=jhpyle/docassemble")')
    print("   ")
    print("   # Log-Verzeichnis erstellen:")
    print("   docker exec $CONTAINER_ID mkdir -p /usr/share/docassemble/log")
    print("   docker exec $CONTAINER_ID chown -R www-data:www-data /usr/share/docassemble/log")
    print("   docker exec $CONTAINER_ID chmod 755 /usr/share/docassemble/log")
    print("   ")
    print("   # Container restart:")
    print("   docker restart $CONTAINER_ID")
    
    print("\n   OPTION 2: VOLUME-MOUNT REPARIEREN")
    print("   # Host-Verzeichnis prÃ¼fen:")
    print("   ls -la /var/docassemble/")
    print("   sudo mkdir -p /var/docassemble/log")
    print("   sudo chown -R 33:33 /var/docassemble/log  # www-data UID:GID")
    print("   sudo chmod 755 /var/docassemble/log")
    
    print("\n   OPTION 3: KOMPLETTER NEUSTART (EMPFOHLEN)")
    print("   # Aktuellen Container stoppen")
    print("   docker stop $(docker ps -q --filter ancestor=jhpyle/docassemble)")
    print("   ")
    print("   # Volume-Verzeichnis reparieren")
    print("   sudo mkdir -p /var/docassemble/log")
    print("   sudo mkdir -p /var/docassemble/config") 
    print("   sudo mkdir -p /var/docassemble/files")
    print("   sudo chown -R 33:33 /var/docassemble/")
    print("   sudo chmod -R 755 /var/docassemble/")
    print("   ")
    print("   # Neuen Container mit korrekter Konfiguration")
    print("   docker run -d --name docassemble_repaired \\")
    print("     -p 8080:80 \\")
    print("     -v /var/docassemble:/usr/share/docassemble \\")
    print("     --memory=4g --memory-swap=4g \\")
    print("     --restart=unless-stopped \\")
    print("     jhpyle/docassemble:latest")
    
    print("\nğŸ” DIAGNOSE-BEFEHLE:")
    print("-" * 20)
    print("   # Volume-Mount Status prÃ¼fen:")
    print("   docker inspect $(docker ps -q --filter ancestor=jhpyle/docassemble) | grep -A 10 Mounts")
    print("   ")
    print("   # Host-Verzeichnis prÃ¼fen:")
    print("   ls -la /var/docassemble/")
    print("   ")
    print("   # Container-Verzeichnis prÃ¼fen:")
    print("   docker exec $(docker ps -q --filter ancestor=jhpyle/docassemble) ls -la /usr/share/docassemble/")
    
    print("\nâš¡ SCHNELLE LÃ–SUNG (VERSUCHEN SIE ZUERST):")
    print("-" * 40)
    print("   # Log-Verzeichnis im Container erstellen:")
    print('   docker exec $(docker ps -q --filter "ancestor=jhpyle/docassemble") mkdir -p /usr/share/docassemble/log')
    print('   docker exec $(docker ps -q --filter "ancestor=jhpyle/docassemble") chown www-data:www-data /usr/share/docassemble/log')
    print("   ")
    print("   # Container restart:")
    print('   docker restart $(docker ps -q --filter "ancestor=jhpyle/docassemble")')
    print("   ")
    print("   # Logs verfolgen:")
    print('   docker logs -f $(docker ps -q --filter "ancestor=jhpyle/docassemble")')
    
    print("\nğŸ¯ WARUM DAS PASSIERT IST:")
    print("-" * 30)
    print("   ğŸ“Š Unsere intensiven API-Tests")
    print("   ğŸ’¾ Haben mÃ¶glicherweise das Dateisystem beschÃ¤digt")
    print("   ğŸ”„ Oder Volume-Mount-Probleme verursacht")
    print("   ğŸ“ Log-Rotation oder Cleanup ging schief")
    
    print("\nâœ… NACH DER REPARATUR ERWARTEN:")
    print("-" * 35)
    print("   âœ… Supervisor startet erfolgreich")
    print("   âœ… Celery-Worker laufen")
    print("   âœ… Alle Docassemble-Services verfÃ¼gbar")
    print("   âœ… Web-Interface funktioniert")
    print("   âœ… APIs funktionieren stabil")
    
    print("\nğŸ“š VORBEUGENDE MASSNAHMEN:")
    print("-" * 30)
    print("   ğŸ”§ Memory-Limits fÃ¼r Container setzen")
    print("   ğŸ“Š Disk Space Monitoring")
    print("   ğŸ§ª Test-Environment separieren")
    print("   â±ï¸ LÃ¤ngere Delays zwischen API-Tests")
    print("   ğŸ’¾ RegelmÃ¤ÃŸige Backups der Volume-Daten")

if __name__ == "__main__":
    analyze_filesystem_error()

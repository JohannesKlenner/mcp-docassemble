# Development Dockerfile f√ºr MCP Docassemble Server
# Hot reload, debugging tools, relaxed security

FROM python:3.12-slim

# Development metadata
LABEL maintainer="MCP Docassemble Team"
LABEL description="MCP Docassemble Server - Development"
LABEL version="1.1.0-dev"

# Install development dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    libc6-dev \
    curl \
    vim \
    git \
    htop \
    && rm -rf /var/lib/apt/lists/*

# Create development user (with sudo for debugging)
RUN groupadd -r mcp --gid=1000 && \
    useradd -r -g mcp --uid=1000 --home-dir=/app --shell=/bin/bash mcp && \
    mkdir -p /app && chown mcp:mcp /app

# Set up application directory
WORKDIR /app

# Install Python dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Install development tools
RUN pip install --no-cache-dir \
    flask-cors \
    watchdog \
    python-lsp-server \
    debugpy \
    ipython \
    jupyter

# Switch to development user
USER mcp

# Set up development environment
ENV PYTHONPATH="/app/src:/app"
ENV PYTHONUNBUFFERED=1
ENV FLASK_ENV=development
ENV FLASK_DEBUG=1

# Development configuration
ENV MCP_HOST=0.0.0.0
ENV MCP_PORT=8080
ENV LOG_LEVEL=DEBUG
ENV LOG_FORMAT=simple

# Create directories
RUN mkdir -p /app/logs /app/tmp

# Expose ports
EXPOSE 8080 5678

# Development startup with hot reload
CMD ["python", "-m", "flask", "--app", "mcp_docassemble.server:app", "run", "--host=0.0.0.0", "--port=8080", "--debug"]
